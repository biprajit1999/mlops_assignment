<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MLOps Assignment â€” Demo UI</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 2rem; }
      label, input, button { display:block; margin: .5rem 0; }
      textarea { width: 100%; height: 6rem; }
      .out { margin-top: 1rem; padding: .5rem; background:#f5f5f5; }
    </style>
  </head>
  <body>
    <h1>Model Prediction UI</h1>
    <p>Enter one or more instances. Each instance is a comma-separated list of features (4 features for Iris example). One instance per line.</p>
    <label for="instances">Instances (one per line):</label>
    <textarea id="instances">5.1,3.5,1.4,0.2</textarea>
    <button id="predict">Predict</button>
    <div class="out" id="result">No prediction yet</div>

    <script>
      function renderResult(data) {
        const container = document.getElementById('result');
        container.innerHTML = '';
        if (data.error) {
          container.innerText = data.error;
          return;
        }
        const preds = data.predictions || [];
        const labels = data.labels || [];
        const probs = data.probabilities || [];
        preds.forEach((p, i) => {
          const row = document.createElement('div');
          row.style.marginBottom = '0.6rem';
          const title = document.createElement('div');
          title.innerHTML = `<strong>Instance ${i+1}:</strong> class=${p}` + (labels[i] ? ` (${labels[i]})` : '');
          row.appendChild(title);
          if (probs[i]) {
            const barWrap = document.createElement('div');
            barWrap.style.display = 'flex';
            barWrap.style.gap = '0.5rem';
            probs[i].forEach((pv, ci) => {
              const block = document.createElement('div');
              block.style.flex = String(pv*100);
              block.style.background = ci === p ? '#2b8cbe' : '#d9d9d9';
              block.style.color = ci === p ? 'white' : 'black';
              block.style.padding = '0.2rem 0.4rem';
              block.style.fontSize = '0.85rem';
              block.innerText = `${labels[ci] || ci}: ${Math.round(pv*100)}%`;
              barWrap.appendChild(block);
            });
            row.appendChild(barWrap);
          }
          container.appendChild(row);
        });
      }

      async function predict() {
        const txt = document.getElementById('instances').value.trim();
        if (!txt) return alert('Please provide instances');
        const lines = txt.split('\n').map(l => l.split(',').map(s => Number(s.trim())));
        const res = await fetch('/predict', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ instances: lines })
        });
        const data = await res.json();
        renderResult(data);
      }
      document.getElementById('predict').addEventListener('click', predict);
    </script>
  </body>
</html>
